<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu·∫£n L√Ω Nh√¢n Vi√™n</title>

    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      body {
        font-family: "Arial", sans-serif;
        background-color: #f8f9fa; /* N·ªÅn tr·∫Øng cho to√†n b·ªô trang */
        margin: 0;
        padding: 0;
        display: flex;
      }

      /* Sidebar */
      .sidebar {
        width: 250px;
        background-color: #2a3b4c;
        height: 100vh;
        padding-top: 50px;
        position: fixed;
        top: 0;
        left: 0;
        color: white;
        display: flex;
        flex-direction: column;
        align-items: stretch;
      }

      .sidebar a {
        display: block;
        padding: 15px;
        font-size: 18px;
        color: white;
        text-decoration: none;
        margin: 10px 0;
        border-radius: 5px;
        transition: background-color 0.3s;
      }

      .sidebar a:hover {
        background-color: #475f6a;
      }

      .active {
        background-color: #007bff;
      }

      /* Content */
      .content {
        margin-left: 260px;
        padding: 20px;
        width: calc(100% - 260px);
        background-color: white; /* M√†u n·ªÅn tr·∫Øng cho ph·∫ßn n·ªôi dung */
        color: black; /* Ch·ªØ m√†u ƒëen ƒë·ªÉ d·ªÖ ƒë·ªçc */
      }

      .container {
        background: rgba(255, 255, 255, 0.95);
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        color: black;
      }

      h1 {
        font-weight: bold;
        color: #343a40; /* Ch·ªânh m√†u ch·ªØ th√†nh m√†u ƒëen s√°ng */
      }

      .form-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .form-header input,
      .form-header select {
        width: 300px;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ddd;
        font-size: 16px;
      }

      .form-header button {
        padding: 10px 20px;
        background-color: #17a2b8;
        color: white;
        border-radius: 8px;
        border: none;
        cursor: pointer;
      }

      .form-header button:hover {
        background-color: #117a8b;
      }

      .table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      .table th,
      .table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }

      .table th {
        background-color: #2a5298;
        color: white;
      }

      .table td {
        background-color: rgba(255, 255, 255, 0.2);
      }

      .table tbody tr:hover {
        background-color: rgba(255, 255, 255, 0.4);
      }

      .btn-export,
      .btn-add {
        padding: 10px 20px;
        background-color: #007bff;
        color: white;
        border-radius: 8px;
        border: none;
        cursor: pointer;
      }

      .btn-export:hover,
      .btn-add:hover {
        background-color: #0056b3;
      }
      .menu-item.disabled { pointer-events: none; color: #6c757d; background-color:
  #f8f9fa; } .menu-item.disabled:hover { cursor: not-allowed; background-color:
  #f8f9fa; }
    </style>
  </head>
  <div>
    <!-- Sidebar -->
    <div class="sidebar">
      <h2 style="text-align: center; color: white; font-weight: bold">Menu</h2>
    </a>
    <!-- Hi·ªÉn th·ªã t·∫•t c·∫£ c√°c menu, nh∆∞ng s·∫Ω disable n·∫øu kh√¥ng c√≥ quy·ªÅn -->
    <a href="{{ url_for('home') }}"><i class="fas fa-home"></i> Trang Ch·ªß</a>

    <!-- Qu·∫£n l√Ω t√†i ch√≠nh -->
    <a href="{{ url_for('quan_li_tai_chinh') }}" 
       class="menu-item {% if 'quan_li_tai_chinh' not in user_permissions %}disabled{% endif %}" 
       {% if 'quan_li_tai_chinh' not in user_permissions %} style="pointer-events: none; color: #6c757d;" {% endif %}>
        <i class="fas fa-chart-line"></i> Qu·∫£n L√≠ T√†i Ch√≠nh
    </a>
    
    <!-- Qu·∫£n l√Ω nh√¢n s·ª± -->
    <a href="{{ url_for('quan_li_nhan_su') }}" class="active"
       class="menu-item {% if 'quan_li_nhan_su' not in user_permissions %}disabled{% endif %}" 
       {% if 'quan_li_nhan_su' not in user_permissions %} style="pointer-events: none; color: #6c757d;" {% endif %}>
        <i class="fas fa-users"></i> Qu·∫£n L√≠ Nh√¢n S·ª±
    </a>
    
    <!-- B√°o c√°o t√†i ch√≠nh -->
    <a href="{{ url_for('bao_cao_tai_chinh') }}" 
       class="menu-item {% if 'bao_cao_tai_chinh' not in user_permissions %}disabled{% endif %}" 
       {% if 'bao_cao_tai_chinh' not in user_permissions %} style="pointer-events: none; color: #6c757d;" {% endif %}>
        <i class="fas fa-chart-line"></i> B√°o C√°o T√†i Ch√≠nh
    </a>
    
    <!-- Ph√≤ng ban ch·ª©c v·ª• -->
    <a href="{{ url_for('phong_ban_chuc_vu') }}" 
       class="menu-item {% if 'phong_ban_chuc_vu' not in user_permissions %}disabled{% endif %}" 
       {% if 'phong_ban_chuc_vu' not in user_permissions %} style="pointer-events: none; color: #6c757d;" {% endif %}>
        <i class="fas fa-shop"></i> Ph√≤ng Ban V√† Ch·ª©c V·ª•
    </a>
    
    <!-- H·ªì s∆° -->
    <a href="{{ url_for('ho_so') }}" 
       class="menu-item {% if 'ho_so' not in user_permissions %}disabled{% endif %}" 
       {% if 'ho_so' not in user_permissions %} style="pointer-events: none; color: #6c757d;" {% endif %}>
        <i class="fas fa-file"></i> H·ªì S∆°
    </a>
    
    <a href="{{ url_for('canh_bao_thong_bao') }}"><i class="fas fa-bell"></i> C·∫£nh B√°o V√† Th√¥ng B√°o</a>
    <a href="{{ url_for('cai_dat') }}" ><i class="fas fa-user"></i> T√†i Kho·∫£n</a>
    <a href="{{ url_for('dang_xuat') }}"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng Xu·∫•t</a>
      
    </div>
    

    <!-- Content -->
    <div class="content">
      <div class="container">
        <h1><i class="fas fa-users"></i> Qu·∫£n L√Ω Nh√¢n Vi√™n</h1>
    
        <div class="form-header mb-4 d-flex gap-2 flex-wrap">
  <input type="text" id="searchInput" placeholder="T√¨m M√£ NV ho·∫∑c H·ªç t√™n" class="form-control" />

  <select id="statusFilter" class="form-control">
    <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
    <option>ƒêang l√†m</option>
    <option>Ngh·ªâ vi·ªác</option>
  </select>

  <select id="departmentFilter" class="form-control">
    <option value="">T·∫•t c·∫£ ph√≤ng ban</option>
    {% for pb in departments %}
    <option value="{{ pb.DepartmentName }}">{{ pb.DepartmentName }}</option>
    {% endfor %}
  </select>

  <select id="positionFilter" class="form-control">
    <option value="">T·∫•t c·∫£ ch·ª©c v·ª•</option>
    {% for cv in positions %}
    <option value="{{ cv.PositionName }}">{{ cv.PositionName }}</option>
    {% endfor %}
  </select>
</div>
          <button
            class="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#addEmployeeModal"
          >
            <i class="fas fa-plus"></i> Th√™m Nh√¢n Vi√™n M·ªõi
          </button>
<a href="{{ url_for('xuat_excel_nhan_vien') }}" class="btn btn-success">
  <i class="fas fa-file-excel"></i> Xu·∫•t Excel
</a>
<form action="{{ url_for('nhap_excel_nhan_vien') }}" method="POST" enctype="multipart/form-data" style="display:inline-block;">
  <input type="file" name="excel_file" accept=".xlsx" required />
  <button type="submit" class="btn btn-primary">üì• Nh·∫≠p Excel</button>
</form>


        </div>
    
        <table class="table table-striped table-hover" id="employeeTable">
          <thead>
  <tr>
    <th>M√£ NV</th>
    <th>H·ªç T√™n</th>
    <th>Ph√≤ng Ban</th>
    <th>Ch·ª©c V·ª•</th>
    <th>Tr·∫°ng Th√°i</th>
    <th>Email</th>
    <th>Ng√†y sinh</th>
    <th>Gi·ªõi t√≠nh</th>
    <th>Ng√†y v√†o l√†m</th>
    <th>H√†nh ƒê·ªông</th>
  </tr>
</thead>

          <tbody>
            {% for nv in nhan_viens %}
            <tr>
              <td>{{ nv.EmployeeID }}</td>
    <td>{{ nv.FullName }}</td>
    <td>{{ nv.DepartmentName }}</td>
    <td>{{ nv.PositionName }}</td>
    <td>{{ nv.Status }}</td>
    <td>{{ nv.Email }}</td>
    <td>{{ nv.BirthDate.strftime('%d/%m/%Y') if nv.BirthDate else '' }}</td>
    <td>{{ nv.Gender }}</td>
    <td>{{ nv.JoinDate.strftime('%d/%m/%Y') if nv.JoinDate else '' }}</td>
              <td>
                <a href="#" class="btn btn-warning btn-sm"
   data-bs-toggle="modal"
   data-bs-target="#updateEmployeeModal"
   onclick="setEmployeeData(
       '{{ nv.EmployeeID }}',
       '{{ nv.FullName }}',
       '{{ nv.DepartmentID }}',
       '{{ nv.PositionID }}',
       '{{ nv.Status }}',
       '{{ nv.Email }}',
       '{{ nv.BirthDate}}',
       '{{ nv.Gender }}',
       '{{ nv.JoinDate  }}'
   )">
  <i class="fas fa-edit"></i> C·∫≠p Nh·∫≠t
</a>

             
                <a href="{{ url_for('xoa_nhan_vien', ma_nv=nv.EmployeeID) }}" class="btn btn-danger btn-sm"
                  onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a nh√¢n vi√™n n√†y?');">
                  <i class="fas fa-trash"></i> X√≥a
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <!-- Modal C·∫≠p Nh·∫≠t Nh√¢n Vi√™n -->
<div class="modal fade" id="updateEmployeeModal" tabindex="-1" aria-labelledby="updateEmployeeModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form method="POST" id="updateEmployeeForm">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">C·∫≠p Nh·∫≠t Nh√¢n Vi√™n</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">

          <input type="hidden" name="employee_id" id="update_employee_id" />

          <div class="mb-3">
            <label class="form-label">H·ªç v√† T√™n:</label>
            <input type="text" class="form-control" name="ho_ten" id="update_ho_ten" required />
          </div>

          <div class="mb-3">
            <label class="form-label">Ph√≤ng Ban:</label>
            <select class="form-select" name="phong_ban" id="update_phong_ban">
              {% for pb in departments %}
              <option value="{{ pb.DepartmentID }}">{{ pb.DepartmentName }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Ch·ª©c V·ª•:</label>
            <select class="form-select" name="chuc_vu" id="update_chuc_vu">
              {% for cv in positions %}
              <option value="{{ cv.PositionID }}">{{ cv.PositionName }}</option>
              {% endfor %}
            </select>
          </div>
<div class="mb-3">
  <label>Khu√¥n m·∫∑t:</label>
  <div class="text-center mb-2">
    <video id="updateFaceVideo" autoplay muted playsinline
      style="width: 320px; height: 240px; border: 1px solid #ddd; border-radius: 8px;">
    </video>
  </div>
  <div class="d-flex justify-content-between">
    <button type="button" id="btnOpenCamera" class="btn btn-info">M·ªü Camera Khu√¥n M·∫∑t</button>
    <button type="button" id="btnCaptureFaceUpdate" class="btn btn-success">Ch·ª•p & G·ª≠i</button>
  </div>
  <div id="updateFaceMessage" class="mt-2"></div>
</div>

          <div class="mb-3">
            <label class="form-label">Tr·∫°ng Th√°i:</label>
            <select class="form-select" name="trang_thai" id="update_trang_thai">
              <option value="ƒêang l√†m">ƒêang l√†m</option>
              <option value="Ngh·ªâ vi·ªác">Ngh·ªâ vi·ªác</option>
            </select>
          </div>
<!-- Email -->
<div class="mb-3">
  <label>Email:</label>
  <input type="email" name="email" id="update_email" class="form-control" required />
</div>

<!-- Ng√†y sinh -->
<div class="mb-3">
  <label>Ng√†y sinh:</label>
  <input type="date" name="birth_date" id="update_birth_date" class="form-control" />
</div>

<!-- Gi·ªõi t√≠nh -->
<div class="mb-3">
  <label>Gi·ªõi t√≠nh:</label>
  <select name="gender" id="update_gender" class="form-select">
    <option value="" disabled>Ch·ªçn gi·ªõi t√≠nh</option>
    <option value="Nam">Nam</option>
    <option value="N·ªØ">N·ªØ</option>
    <option value="Kh√°c">Kh√°c</option>
  </select>
</div>

<!-- Ng√†y v√†o l√†m -->
<div class="mb-3">
  <label>Ng√†y v√†o l√†m:</label>
  <input type="date" name="join_date" id="update_join_date" class="form-control" />
</div>


          <div class="mb-3">
            <label class="form-label">T√†i Kho·∫£n:</label>
            <input type="text" class="form-control" name="username" id="update_username" required />
          </div>

          <div class="mb-3">
            <label class="form-label">M·∫≠t Kh·∫©u (ƒë·ªÉ tr·ªëng n·∫øu kh√¥ng ƒë·ªïi):</label>
            <input type="password" class="form-control" name="password" id="update_password" />
          </div>

          <div class="mb-3">
            <label class="form-label">Quy·ªÅn:</label>
            <select class="form-select" name="role_id" id="update_role_id">
              {% for role in roles %}
              <option value="{{ role.role_id }}">{{ role.role_name }}</option>
              {% endfor %}
            </select>
          </div>
          
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">
            <i class="fas fa-sync-alt"></i> C·∫≠p Nh·∫≠t
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

 <!-- Modal Th√™m Nh√¢n Vi√™n M·ªõi -->
<div class="modal fade" id="addEmployeeModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form method="POST" action="{{ url_for('them_nhan_vien') }}">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Th√™m Nh√¢n Vi√™n M·ªõi</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <!-- M√£ Nh√¢n Vi√™n -->
          <div class="mb-3">
            <label>M√£ NV:</label>
            <input type="number" name="employee_id" class="form-control" required>
          </div>
          <!-- H·ªç v√† t√™n -->
          <div class="mb-3">
            <label>H·ªç v√† T√™n:</label>
            <input type="text" name="ho_ten" class="form-control" required>
          </div>
          <!-- Ph√≤ng Ban -->
          <div class="mb-3">
            <label>Ph√≤ng Ban:</label>
            <select name="phong_ban" class="form-select" required>
              <option value="" disabled selected>Ch·ªçn ph√≤ng ban</option>
              {% for pb in departments %}
              <option value="{{ pb.DepartmentID }}">{{ pb.DepartmentName }}</option>
              {% endfor %}
            </select>
          </div>
          <!-- Ch·ª©c V·ª• -->
          <div class="mb-3">
            <label>Ch·ª©c V·ª•:</label>
            <select name="chuc_vu" class="form-select" required>
              <option value="" disabled selected>Ch·ªçn ch·ª©c v·ª•</option>
              {% for cv in positions %}
              <option value="{{ cv.PositionID }}">{{ cv.PositionName }}</option>
              {% endfor %}
            </select>
          </div>
          <!-- Tr·∫°ng Th√°i -->
          <div class="mb-3">
            <label>Tr·∫°ng Th√°i:</label>
            <select name="trang_thai" class="form-select" required>
              <option value="ƒêang l√†m">ƒêang l√†m</option>
              <option value="Ngh·ªâ vi·ªác">Ngh·ªâ vi·ªác</option>
            </select>
          </div>
          <!-- Email -->
<div class="mb-3">
  <label>Email:</label>
  <input type="email" name="email" id="update_email" class="form-control" required />
</div>

<!-- Ng√†y sinh -->
<div class="mb-3">
  <label>Ng√†y sinh:</label>
  <input type="date" name="birth_date" id="update_birth_date" class="form-control" />
</div>

<!-- Gi·ªõi t√≠nh -->
<div class="mb-3">
  <label>Gi·ªõi t√≠nh:</label>
  <select name="gender" id="update_gender" class="form-select">
    <option value="" disabled>Ch·ªçn gi·ªõi t√≠nh</option>
    <option value="Nam">Nam</option>
    <option value="N·ªØ">N·ªØ</option>
    <option value="Kh√°c">Kh√°c</option>
  </select>
</div>

<!-- Ng√†y v√†o l√†m -->
<div class="mb-3">
  <label>Ng√†y v√†o l√†m:</label>
  <input type="date" name="join_date" id="update_join_date" class="form-control" />
</div>


          <div class="mb-3">
          <label for="username" class="form-label">T√™n t√†i kho·∫£n</label>
          <input type="text" class="form-control" name="username" id="username" required>
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">M·∫≠t kh·∫©u</label>
          <input type="password" class="form-control" name="password" id="password" required>
        </div>
        <label for="role_id">Ch·ªçn Quy·ªÅn:</label>
<select name="role_id" id="role_id" required>
  <option value="2">Admin</option>
  <option value="3">HR</option>
  <option value="4">Payroll Manager</option>
  <option value="5">Employee</option>
</select>

        </div>
        <div class="modal-footer">
          <button class="btn btn-primary">
            <i class="fas fa-plus"></i> Th√™m Nh√¢n Vi√™n
          </button>
        </div>
      </div>
    </form>
  </div>
</div>


<!-- Modal C·∫≠p Nh·∫≠t Nh√¢n Vi√™n -->
<div class="modal fade" id="updateEmployeeModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form method="POST">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">C·∫≠p Nh·∫≠t Nh√¢n Vi√™n</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="employee_id" id="update_employee_id">
          <div class="mb-3">
            <label>H·ªç v√† T√™n:</label>
            <input type="text" name="ho_ten" id="update_ho_ten" class="form-control" required>
          </div>
          <div class="mb-3">
            <label>Ph√≤ng Ban:</label>
            <select name="phong_ban" id="update_phong_ban" class="form-select" required>
              {% for pb in departments %}
              <option value="{{ pb.DepartmentID }}">{{ pb.DepartmentName }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label>Ch·ª©c V·ª•:</label>
            <select name="chuc_vu" id="update_chuc_vu" class="form-select" required>
              {% for cv in positions %}
              <option value="{{ cv.PositionID }}">{{ cv.PositionName }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label>Tr·∫°ng Th√°i:</label>
            <select name="trang_thai" id="update_trang_thai" class="form-select" required>
              <option value="ƒêang l√†m">ƒêang l√†m</option>
              <option value="Ngh·ªâ vi·ªác">Ngh·ªâ vi·ªác</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-success"><i class="fas fa-sync-alt"></i> C·∫≠p Nh·∫≠t</button>
        </div>
      </div>
    </form>
  </div>
</div>
<script>
  const videoUpdate = document.getElementById("updateFaceVideo");
  const btnOpenCamera = document.getElementById("btnOpenCamera");
  const btnCaptureFaceUpdate = document.getElementById("btnCaptureFaceUpdate");
  const updateFaceMessage = document.getElementById("updateFaceMessage");

  let streamUpdate = null;

  btnOpenCamera.onclick = async () => {
    try {
      streamUpdate = await navigator.mediaDevices.getUserMedia({ video: true });
      videoUpdate.srcObject = streamUpdate;
      updateFaceMessage.textContent = "Camera ƒë√£ m·ªü, chu·∫©n b·ªã ch·ª•p ·∫£nh...";
      updateFaceMessage.style.color = "black";
    } catch (err) {
      updateFaceMessage.textContent = "L·ªói m·ªü camera: " + err.message;
      updateFaceMessage.style.color = "red";
    }
  };

  btnCaptureFaceUpdate.onclick = async () => {
    if (!streamUpdate) {
      updateFaceMessage.textContent = "Vui l√≤ng m·ªü camera tr∆∞·ªõc.";
      updateFaceMessage.style.color = "red";
      return;
    }

    // Ch·ª•p ·∫£nh t·ª´ video
    const canvas = document.createElement("canvas");
    canvas.width = videoUpdate.videoWidth;
    canvas.height = videoUpdate.videoHeight;
    const ctx = canvas.getContext("2d");
    ctx.drawImage(videoUpdate, 0, 0, canvas.width, canvas.height);
    const imageData = canvas.toDataURL("image/jpeg");

    updateFaceMessage.textContent = "ƒêang g·ª≠i ·∫£nh khu√¥n m·∫∑t...";

    // L·∫•y employee_id t·ª´ input hidden ho·∫∑c n∆°i l∆∞u
    const employee_id = document.getElementById("update_employee_id").value;

    try {
      const response = await fetch(`/api/register-face/${employee_id}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ image: imageData }),
      });

      const data = await response.json();
      if (data.success) {
        updateFaceMessage.style.color = "green";
        updateFaceMessage.textContent = data.message;
      } else {
        updateFaceMessage.style.color = "red";
        updateFaceMessage.textContent = data.message;
      }
    } catch (error) {
      updateFaceMessage.style.color = "red";
      updateFaceMessage.textContent = "L·ªói k·∫øt n·ªëi: " + error.message;
    }
  };
</script>

<script>
 function setEmployeeData(id, name, dept, pos, status, email, birth_date, gender, join_date) {
  document.getElementById("update_employee_id").value = id;
  document.getElementById("update_ho_ten").value = name;
  document.getElementById("update_phong_ban").value = dept;
  document.getElementById("update_chuc_vu").value = pos;
  document.getElementById("update_trang_thai").value = status;
  document.getElementById("update_email").value = email || '';
  document.getElementById("update_birth_date").value = birth_date || '';
  document.getElementById("update_gender").value = gender || '';
  document.getElementById("update_join_date").value = join_date || '';

  document.querySelector("#updateEmployeeModal form").action = "/cap-nhat-nhan-vien/" + id;
}

</script>

<script>
  const searchInput = document.getElementById("searchInput");
  const statusFilter = document.getElementById("statusFilter");
  const departmentFilter = document.getElementById("departmentFilter");
  const positionFilter = document.getElementById("positionFilter");
  const table = document.getElementById("employeeTable");
  const rows = table.querySelectorAll("tbody tr");

  function filterTable() {
    const keyword = searchInput.value.toLowerCase();
    const status = statusFilter.value;
    const department = departmentFilter.value;
    const position = positionFilter.value;

    rows.forEach((row) => {
      const maNV = row.cells[0].textContent.toLowerCase();
      const hoTen = row.cells[1].textContent.toLowerCase();
      const phongBan = row.cells[2].textContent;
      const chucVu = row.cells[3].textContent;
      const trangThai = row.cells[4].textContent;

      const matchKeyword = maNV.includes(keyword) || hoTen.includes(keyword);
      const matchStatus = !status || trangThai === status;
      const matchDep = !department || phongBan === department;
      const matchPos = !position || chucVu === position;

      row.style.display = matchKeyword && matchStatus && matchDep && matchPos ? "" : "none";
    });
  }

  searchInput.addEventListener("input", filterTable);
  statusFilter.addEventListener("change", filterTable);
  departmentFilter.addEventListener("change", filterTable);
  positionFilter.addEventListener("change", filterTable);
</script>

<script>
function exportTableToExcel(tableID, filename = '') {
  const dataType = 'application/vnd.ms-excel';
  const tableSelect = document.getElementById(tableID);
  const tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');
  
  filename = filename ? filename + '.xls' : 'excel_data.xls';
  
  const downloadLink = document.createElement("a");
  document.body.appendChild(downloadLink);

  if (navigator.msSaveOrOpenBlob) {
    const blob = new Blob(['\ufeff', tableHTML], { type: dataType });
    navigator.msSaveOrOpenBlob(blob, filename);
  } else {
    downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
    downloadLink.download = filename;
    downloadLink.click();
  }
}
</script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
